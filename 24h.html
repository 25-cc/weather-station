---
permalink: /24h.html
layout: default
title: 24-hour forecast
---
<div class = "row">
    <div class="col">
        <div class="card card-cover h-100 overflow-hidden text-bg-dark rounded-4 shadow-lg" style="background-image: url(&quot;/assets/images/24h_forecast_banner.jpg&quot;);">
            <div class="d-flex flex-column h-100 p-5 pb-3 text-white text-shadow-1">
                <h3 class="pt-5 mt-5 mb-4 display-6 lh-1 fw-bold">24-hour forecast</h3>
            </div>
        </div>
    </div>
</div>

<div class="container px-4 py-5" id="icon-grid"> 
    <h4 class="pb-2 border-bottom">Valid from <span id = "f24h_validity">xx period to yy period</span></h4>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4 py-5"> 
        <div class="col d-flex align-items-start"> 
            <svg xmlns="http://www.w3.org/2000/svg" width="1.75em" height="1.75em" fill="currentColor" class="bi bi-cloud-sun" viewBox="0 0 16 16">
                <path d="M7 8a3.5 3.5 0 0 1 3.5 3.555.5.5 0 0 0 .624.492A1.503 1.503 0 0 1 13 13.5a1.5 1.5 0 0 1-1.5 1.5H3a2 2 0 1 1 .1-3.998.5.5 0 0 0 .51-.375A3.5 3.5 0 0 1 7 8m4.473 3a4.5 4.5 0 0 0-8.72-.99A3 3 0 0 0 3 16h8.5a2.5 2.5 0 0 0 0-5z"/>
                <path d="M10.5 1.5a.5.5 0 0 0-1 0v1a.5.5 0 0 0 1 0zm3.743 1.964a.5.5 0 1 0-.707-.707l-.708.707a.5.5 0 0 0 .708.708zm-7.779-.707a.5.5 0 0 0-.707.707l.707.708a.5.5 0 1 0 .708-.708zm1.734 3.374a2 2 0 1 1 3.296 2.198q.3.423.516.898a3 3 0 1 0-4.84-3.225q.529.017 1.028.129m4.484 4.074c.6.215 1.125.59 1.522 1.072a.5.5 0 0 0 .039-.742l-.707-.707a.5.5 0 0 0-.854.377M14.5 6.5a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z"/>
            </svg>
            <div> 
                <h3 class="fw-bold mb-0 fs-4 text-body-emphasis">Overall forecast</h3>
                <br>
                <p><span id = "f24h_weather">Windy</span></p> 
            </div> 
        </div> 
        <div class="col d-flex align-items-start"> 
            <svg xmlns="http://www.w3.org/2000/svg" width="1.75em" height="1.75em" fill="currentColor" class="bi bi-thermometer-sun" viewBox="0 0 16 16">
                <path d="M5 12.5a1.5 1.5 0 1 1-2-1.415V2.5a.5.5 0 0 1 1 0v8.585A1.5 1.5 0 0 1 5 12.5"/>
                <path d="M1 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0zM3.5 1A1.5 1.5 0 0 0 2 2.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0L5 10.486V2.5A1.5 1.5 0 0 0 3.5 1m5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0v-1a.5.5 0 0 1 .5-.5m4.243 1.757a.5.5 0 0 1 0 .707l-.707.708a.5.5 0 1 1-.708-.708l.708-.707a.5.5 0 0 1 .707 0M8 5.5a.5.5 0 0 1 .5-.5 3 3 0 1 1 0 6 .5.5 0 0 1 0-1 2 2 0 0 0 0-4 .5.5 0 0 1-.5-.5M12.5 8a.5.5 0 0 1 .5-.5h1a.5.5 0 1 1 0 1h-1a.5.5 0 0 1-.5-.5m-1.172 2.828a.5.5 0 0 1 .708 0l.707.708a.5.5 0 0 1-.707.707l-.708-.707a.5.5 0 0 1 0-.708M8.5 12a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0v-1a.5.5 0 0 1 .5-.5"/>
            </svg>
            <div> 
                <h3 class="fw-bold mb-0 fs-4 text-body-emphasis">Temperature</h3> 
                <br>
                <p>High: <span id = "f24h_temp_high"></span>°C</p> 
                <p>Low: <span id = "f24h_temp_low"></span>°C</p> 
            </div> 
        </div>
        <div class="col d-flex align-items-start"> 
            <svg xmlns="http://www.w3.org/2000/svg" width="1.75em" height="1.75em" fill="currentColor" class="bi bi-droplet" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M7.21.8C7.69.295 8 0 8 0q.164.544.371 1.038c.812 1.946 2.073 3.35 3.197 4.6C12.878 7.096 14 8.345 14 10a6 6 0 0 1-12 0C2 6.668 5.58 2.517 7.21.8m.413 1.021A31 31 0 0 0 5.794 3.99c-.726.95-1.436 2.008-1.96 3.07C3.304 8.133 3 9.138 3 10a5 5 0 0 0 10 0c0-1.201-.796-2.157-2.181-3.7l-.03-.032C9.75 5.11 8.5 3.72 7.623 1.82z"/>
                <path fill-rule="evenodd" d="M4.553 7.776c.82-1.641 1.717-2.753 2.093-3.13l.708.708c-.29.29-1.128 1.311-1.907 2.87z"/>
            </svg>
            <div> 
                <h3 class="fw-bold mb-0 fs-4 text-body-emphasis">Relative humidity</h3> 
                <br>
                <p>High: <span id = "f24h_rh_high"></span>%</p> 
                <p>Low: <span id = "f24h_rh_low"></span>%</p> 
            </div> 
        </div>
        <div class="col d-flex align-items-start"> 
            <svg xmlns="http://www.w3.org/2000/svg" width="1.75em" height="1.75em" fill="currentColor" class="bi bi-fan" viewBox="0 0 16 16">
                <path d="M10 3c0 1.313-.304 2.508-.8 3.4a2 2 0 0 0-1.484-.38c-.28-.982-.91-2.04-1.838-2.969a8 8 0 0 0-.491-.454A6 6 0 0 1 8 2c.691 0 1.355.117 1.973.332Q10 2.661 10 3m0 5q0 .11-.012.217c1.018-.019 2.2-.353 3.331-1.006a8 8 0 0 0 .57-.361 6 6 0 0 0-2.53-3.823 9 9 0 0 1-.145.64c-.34 1.269-.944 2.346-1.656 3.079.277.343.442.78.442 1.254m-.137.728a2 2 0 0 1-1.07 1.109c.525.87 1.405 1.725 2.535 2.377q.3.174.605.317a6 6 0 0 0 2.053-4.111q-.311.11-.641.199c-1.264.339-2.493.356-3.482.11ZM8 10c-.45 0-.866-.149-1.2-.4-.494.89-.796 2.082-.796 3.391q0 .346.027.678A6 6 0 0 0 8 14c.94 0 1.83-.216 2.623-.602a8 8 0 0 1-.497-.458c-.925-.926-1.555-1.981-1.836-2.96Q8.149 10 8 10M6 8q0-.12.014-.239c-1.02.017-2.205.351-3.34 1.007a8 8 0 0 0-.568.359 6 6 0 0 0 2.525 3.839 8 8 0 0 1 .148-.653c.34-1.267.94-2.342 1.65-3.075A2 2 0 0 1 6 8m-3.347-.632c1.267-.34 2.498-.355 3.488-.107.196-.494.583-.89 1.07-1.1-.524-.874-1.406-1.733-2.541-2.388a8 8 0 0 0-.594-.312 6 6 0 0 0-2.06 4.106q.309-.11.637-.199M8 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
            </svg>
            <div> 
                <h3 class="fw-bold mb-0 fs-4 text-body-emphasis">Wind speed</h3> 
                <br>
                <p>High: <span id = "f24h_wind_high"></span></p> 
                <p>Low: <span id = "f24h_wind_low"></span></p> 
            </div> 
        </div>
    </div>
</div>
<div class = "row">
    <div class = "col">
        <div class="bg-body-tertiary rounded-3">
            <div class="container-fluid">
                <div><h5>Hover over the markers to see the forecasts for the next 24 hours.</h5></div>
                <div id="map" style="height: 600px; width: 100%;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    let map;
    
    async function get_api_data(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Error occured. Response code ${response.status}`);
            }
            const result = await response.json();
            if (result.code != 0) {
                throw new Error (`Unable to fetch data from API. Error message: ${result.errorMsg}`)
                return undefined;
            } else {
                return result;
            }
        }
        catch (error) {
            console.error(error.message);
            return undefined;
        }
    }
    
    async function getForecast() {
        const forecast_24h_url = "https://api-open.data.gov.sg/v2/real-time/api/twenty-four-hr-forecast";
        forecast_24h = await get_api_data(forecast_24h_url);
        return displayForecasts();
    }
    
    function map_render() {
        map = L.map('map', {center: [1.35, 103.805], zoom: 12, trackResize: false, zoomControl: false});
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        map.setMaxBounds([[1.48, 103.6],[1.1551318634546959, 104.14146423339845]]);
    }
    
    function displayForecasts() {
        if (forecast_24h == undefined) {
            throw new Error(`Information retrieval unsuccessful.`)
            return;
        }
        
        document.querySelector("#f24h_validity").innerHTML = forecast_24h.data.records[0].general.validPeriod.text;
        document.querySelector("#f24h_weather").innerHTML = forecast_24h.data.records[0].general.forecast.text;
        document.querySelector("#f24h_temp_high").innerHTML = forecast_24h.data.records[0].general.temperature.high;
        document.querySelector("#f24h_temp_low").innerHTML = forecast_24h.data.records[0].general.temperature.low;
        document.querySelector("#f24h_rh_high").innerHTML = forecast_24h.data.records[0].general.relativeHumidity.high;
        document.querySelector("#f24h_rh_low").innerHTML = forecast_24h.data.records[0].general.relativeHumidity.low;
        document.querySelector("#f24h_wind_high").innerHTML = forecast_24h.data.records[0].general.wind.speed.high;
        document.querySelector("#f24h_wind_low").innerHTML = forecast_24h.data.records[0].general.wind.speed.low;
        
        // List of locations taken from PM2.5 API data
        const readingLocations = [{"name":"west","labelLocation":{"latitude":1.35735,"longitude":103.7}},
        {"name":"east","labelLocation":{"latitude":1.35735,"longitude":103.94}},
        {"name":"central","labelLocation":{"latitude":1.35735,"longitude":103.82}},
        {"name":"south","labelLocation":{"latitude":1.29587,"longitude":103.82}},
        {"name":"north","labelLocation":{"latitude":1.41803,"longitude":103.82}}]
        
        
        for (loc of readingLocations) {
            let tooltipText = "";
            window[`${loc.name}Marker`] = L.marker([loc.labelLocation.latitude, loc.labelLocation.longitude]).addTo(map);
            for (period of forecast_24h.data.records[0].periods) {
                tooltipText += `${period.timePeriod.text}: ${period.regions[loc.name].text}<br />`
            }
            window[`${loc.name}Marker`].bindTooltip(tooltipText)     
        }
    }
    
    getForecast();
    map_render();
</script>